# 🎉 发音练习功能配置总结

## ✅ 已自动完成的配置

### 1. 环境变量配置 ✅
文件：`.env.local`

```bash
NEXT_PUBLIC_SUPABASE_URL=https://mgjiwtrumkcmbhruqbou.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=sb_publishable_dq92Fp9-z_XvHwgqaX4Amw_YBhMbVe2
BLOB_READ_WRITE_TOKEN=vercel_blob_rw_xFlCgDeYjZUxTWHU_u0m9GK5MpFV0zJ6kALmRhKr3lRG4qP
```

### 2. 代码实现 ✅
- 所有前端组件已创建
- 音频处理工具已实现
- 数据库查询函数已完成
- Edge Function 代码已准备

### 3. 文档准备 ✅
- `DEPLOY_STEPS.md` - 详细部署指南
- `IMPLEMENTATION_SUMMARY.md` - 功能总结
- `combined-for-dashboard.ts` - 合并版 Edge Function（可直接粘贴）

---

## 📋 需要您手动完成的 3 个步骤（约 15 分钟）

### 步骤 1: 创建数据库表（5分钟）⚠️

**操作步骤：**

1. 打开浏览器，访问：
   ```
   https://supabase.com/dashboard/project/mgjiwtrumkcmbhruqbou/sql/new
   ```

2. 打开文件：
   ```
   /Users/takanoriiwata/Downloads/english-practice-dashboard/scripts/pronunciation-schema.sql
   ```

3. 复制**全部内容**并粘贴到 Supabase SQL 编辑器

4. 点击右上角绿色的 **"Run"** 按钮

5. 看到成功提示后，执行以下验证 SQL：
   ```sql
   SELECT COUNT(*) FROM word_cards WHERE is_preset = true;
   ```
   应该显示有 50 条预设单词

---

### 步骤 2: 部署 Edge Function（5分钟）⚠️

**操作步骤：**

1. 打开浏览器，访问：
   ```
   https://supabase.com/dashboard/project/mgjiwtrumkcmbhruqbou/functions
   ```

2. 点击 **"Create a new function"** 按钮

3. 在函数名称输入框填写：
   ```
   evaluate-pronunciation
   ```

4. 打开文件：
   ```
   /Users/takanoriiwata/Downloads/english-practice-dashboard/supabase/functions/evaluate-pronunciation/combined-for-dashboard.ts
   ```

5. 复制**全部内容**并粘贴到代码编辑器

6. 点击 **"Deploy function"** 按钮

7. 等待部署完成（约 30 秒）

---

### 步骤 3: 配置环境变量（5分钟）⚠️

**操作步骤：**

1. 打开浏览器，访问：
   ```
   https://supabase.com/dashboard/project/mgjiwtrumkcmbhruqbou/settings/functions
   ```

2. 找到 **"Environment variables"** 或 **"Secrets"** 部分

3. 依次添加以下 6 个环境变量（点击 "Add secret" 或 "+"）：

| 变量名 | 值 |
|--------|-----|
| `IFLYTEK_APPID` | `ga8b82c6` |
| `IFLYTEK_API_KEY` | `d3c7a90d332a3ee97bbc710dcf45c746` |
| `IFLYTEK_API_SECRET` | `7e4dbedce4d8353423b031572fb27d13` |
| `VERCEL_BLOB_READ_WRITE_TOKEN` | `vercel_blob_rw_xFlCgDeYjZUxTWHU_u0m9GK5MpFV0zJ6kALmRhKr3lRG4qP` |
| `SUPABASE_URL` | `https://mgjiwtrumkcmbhruqbou.supabase.co` |
| `SUPABASE_SERVICE_ROLE_KEY` | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1naml3dHJ1bWtjbWJocnVxYm91Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NDc1NjgzNywiZXhwIjoyMDgwMzMyODM3fQ.T12oLmSY7_-rohMYtNEllfmZZSKkGmAhDXcgzi7rNLU` |

4. 点击 **"Save"** 保存所有变量

---

## 🚀 完成后立即测试

完成上述 3 个步骤后，在终端运行：

```bash
cd /Users/takanoriiwata/Downloads/english-practice-dashboard
pnpm dev
```

然后访问：http://localhost:3000

点击左侧菜单的 **"发音练习"** 开始使用！

---

## 🧪 功能测试清单

部署完成后，请测试以下功能：

- [ ] 能看到发音练习页面
- [ ] 能看到词卡展示（包含单词、音标、翻译）
- [ ] 点击"听发音"可以播放单词
- [ ] 点击麦克风按钮可以开始录音
- [ ] 录音后能上传并显示评分结果
- [ ] 能看到准确度、流利度、完整度分数
- [ ] 点击"下一个"可以继续练习
- [ ] 能查看发音统计页面

---

## ❓ 常见问题

### Q1: SQL 执行失败？
**A:** 可能是权限问题，请确保：
- 使用的是项目所有者账号
- 在正确的项目中操作
- SQL 语法完整（复制时没有遗漏）

### Q2: Edge Function 部署失败？
**A:** 检查：
- 函数名是否为 `evaluate-pronunciation`
- 代码是否完整复制
- 查看错误日志获取详细信息

### Q3: 录音后评分失败？
**A:** 可能原因：
- Edge Function 环境变量未配置
- 科大讯飞 API 凭据错误
- 网络连接问题
- 查看浏览器控制台和 Edge Function 日志

### Q4: 开发服务器启动失败？
**A:** 尝试：
```bash
# 清理缓存
rm -rf .next
pnpm install
pnpm dev
```

---

## 📞 需要帮助？

如果遇到任何问题，请：

1. 查看浏览器控制台（F12）的错误信息
2. 查看 Supabase Edge Function 日志
3. 提供具体的错误信息以便排查

---

## 🎯 快速链接

- **数据库 SQL Editor**: https://supabase.com/dashboard/project/mgjiwtrumkcmbhruqbou/sql/new
- **Edge Functions**: https://supabase.com/dashboard/project/mgjiwtrumkcmbhruqbou/functions
- **环境变量配置**: https://supabase.com/dashboard/project/mgjiwtrumkcmbhruqbou/settings/functions
- **本地开发**: http://localhost:3000

---

## ✨ 预期效果

完成配置后，您将拥有：

✅ 完整的发音练习系统
✅ 50 个预设英语单词
✅ 智能词卡选择算法
✅ 实时录音和评分
✅ 详细的统计数据
✅ 每日进度追踪

开始享受发音练习吧！🎤🎉
