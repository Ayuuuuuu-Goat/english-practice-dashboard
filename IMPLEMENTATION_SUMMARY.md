# æ¯æ—¥è¯å¡å‘éŸ³ç»ƒä¹ åŠŸèƒ½ - å®æ–½æ€»ç»“

## âœ… å®æ–½å®ŒæˆçŠ¶æ€

æ‰€æœ‰åŠŸèƒ½å·²æˆåŠŸå®ç°ï¼æœ¬æ–‡æ¡£æ€»ç»“äº†å®æ–½çš„æ‰€æœ‰ç»„ä»¶å’ŒåŠŸèƒ½ã€‚

## ğŸ“¦ å·²åˆ›å»ºçš„æ–‡ä»¶æ¸…å•

### 1. æ•°æ®åº“ Schema
- âœ… `scripts/pronunciation-schema.sql` - å®Œæ•´çš„æ•°æ®åº“æ¶æ„å’Œé¢„è®¾æ•°æ®

### 2. åç«¯ API

#### Supabase Edge Function
- âœ… `supabase/functions/evaluate-pronunciation/index.ts` - ä¸»è¯„æµ‹é€»è¾‘
- âœ… `supabase/functions/evaluate-pronunciation/signature.ts` - API ç­¾åç”Ÿæˆ
- âœ… `supabase/functions/evaluate-pronunciation/iflytek-client.ts` - WebSocket å®¢æˆ·ç«¯

#### Next.js API Routes
- âœ… `app/api/pronunciation/upload-audio/route.ts` - éŸ³é¢‘ä¸Šä¼ åˆ° Vercel Blob

### 3. å‰ç«¯å·¥å…·åº“

#### TypeScript ç±»å‹
- âœ… `lib/pronunciation/types.ts` - å®Œæ•´çš„ç±»å‹å®šä¹‰

#### æ ¸å¿ƒå·¥å…·
- âœ… `lib/pronunciation/audio-utils.ts` - éŸ³é¢‘å½•åˆ¶ã€è½¬æ¢ã€ä¸Šä¼ å·¥å…·
- âœ… `lib/pronunciation/word-selection.ts` - æ™ºèƒ½è¯å¡é€‰æ‹©ç®—æ³•

#### æ•°æ®åº“æŸ¥è¯¢
- âœ… `lib/supabase/pronunciation-queries.ts` - Supabase æ•°æ®åº“æŸ¥è¯¢å‡½æ•°

### 4. UI ç»„ä»¶

- âœ… `components/pronunciation/audio-recorder.tsx` - å½•éŸ³ç»„ä»¶
- âœ… `components/pronunciation/word-card-display.tsx` - è¯å¡å±•ç¤ºç»„ä»¶
- âœ… `components/pronunciation/score-display.tsx` - è¯„åˆ†ç»“æœå±•ç¤º
- âœ… `components/pronunciation/pronunciation-practice-page.tsx` - ä¸»ç»ƒä¹ é¡µé¢
- âœ… `components/pronunciation/pronunciation-stats.tsx` - ç»Ÿè®¡æ•°æ®é¡µé¢

### 5. åº”ç”¨é›†æˆ

- âœ… æ›´æ–° `components/dashboard/sidebar.tsx` - æ·»åŠ å‘éŸ³ç»ƒä¹ å…¥å£
- âœ… æ›´æ–° `app/page.tsx` - é›†æˆå‘éŸ³ç»ƒä¹ è·¯ç”±

### 6. é…ç½®æ–‡ä»¶

- âœ… `.env.local.example` - ç¯å¢ƒå˜é‡ç¤ºä¾‹
- âœ… `PRONUNCIATION_IMPLEMENTATION.md` - è¯¦ç»†å®æ–½æŒ‡å—
- âœ… `tsconfig.json` - æ›´æ–°ä»¥æ’é™¤ Deno ä»£ç 

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. æ™ºèƒ½è¯å¡é€‰æ‹©ç³»ç»Ÿ

**é€‰æ‹©ç­–ç•¥ä¼˜å…ˆçº§ï¼š**
1. ä»æœªç»ƒä¹ è¿‡çš„è¯ï¼ˆä¼˜å…ˆçº§ 1000ï¼‰
2. æœ€è¿‘åˆ†æ•°ä½äº 70 åˆ†çš„è¯ï¼ˆä¼˜å…ˆçº§ 800-900ï¼‰
3. 7 å¤©ä»¥ä¸Šæœªç»ƒä¹ çš„è¯ï¼ˆä¼˜å…ˆçº§ 500-700ï¼‰
4. æœ€è¿‘ç»ƒä¹ ä¸”åˆ†æ•°å¥½çš„è¯ï¼ˆä¼˜å…ˆçº§ 100-400ï¼‰

**éš¾åº¦åˆ†å¸ƒï¼ˆæ··åˆæ¨¡å¼ï¼‰ï¼š**
- ç®€å•è¯ï¼š50%
- ä¸­ç­‰è¯ï¼š30%
- å›°éš¾è¯ï¼š20%

### 2. éŸ³é¢‘å¤„ç†æµç¨‹

```
ç”¨æˆ·å½•éŸ³
    â†“
MediaRecorder (webm/opus)
    â†“
WAV è½¬æ¢ (16kHz, 16-bit, Mono)
    â†“
Vercel Blob ä¸Šä¼ 
    â†“
ç§‘å¤§è®¯é£ WebSocket è¯„æµ‹
    â†“
ç»“æœå­˜å‚¨åˆ° Supabase
    â†“
å±•ç¤ºè¯„åˆ†å’Œåé¦ˆ
```

### 3. è¯„åˆ†ç³»ç»Ÿ

**è‹±è¯­è¯„æµ‹æŒ‡æ ‡ï¼š**
- æ€»åˆ† (total_score): 0-100
- å‡†ç¡®åº¦ (accuracy_score): éŸ³ç´ å‡†ç¡®æ€§
- æµåˆ©åº¦ (fluency_score): è¯­é€Ÿå’Œè¿è´¯æ€§
- å®Œæ•´åº¦ (integrity_score): æ˜¯å¦è¯»å®Œæ•´

**ä¸­æ–‡è¯„æµ‹æŒ‡æ ‡ï¼š**
- éŸ³ç´ åˆ† (phone_score)
- å£°è°ƒåˆ† (tone_score)

**è¯„åˆ†ç­‰çº§ï¼š**
- A: 90-100 åˆ†ï¼ˆä¼˜ç§€ï¼‰
- B: 80-89 åˆ†ï¼ˆè‰¯å¥½ï¼‰
- C: 70-79 åˆ†ï¼ˆåŠæ ¼ï¼‰
- D: 60-69 åˆ†ï¼ˆéœ€åŠ å¼ºï¼‰
- F: 0-59 åˆ†ï¼ˆéœ€å¤§é‡ç»ƒä¹ ï¼‰

### 4. ç”¨æˆ·ä½“éªŒç‰¹æ€§

- ğŸ¤ ä¸€é”®å½•éŸ³ï¼Œå®æ—¶æ³¢å½¢åŠ¨ç”»
- ğŸ“Š å³æ—¶è¯„åˆ†åé¦ˆ
- ğŸ“ˆ æ¯æ—¥è¿›åº¦è¿½è¸ª
- ğŸ† è¿ç»­ç»ƒä¹ å¤©æ•°ç»Ÿè®¡
- ğŸ“± ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡
- ğŸ”Š TTS è¯­éŸ³ç¤ºèŒƒ
- âš¡ å¿«é€ŸåŠ è½½å’Œå¤„ç†

## ğŸ“Š æ•°æ®åº“æ¶æ„

### è¡¨ç»“æ„

1. **word_cards** (è¯å¡è¡¨)
   - é¢„è®¾è¯åº“ + ç”¨æˆ·è‡ªå®šä¹‰
   - æ”¯æŒè‹±è¯­å’Œä¸­æ–‡
   - åŒ…å«éŸ³æ ‡ã€é‡Šä¹‰ã€ä¾‹å¥
   - ä¸‰çº§éš¾åº¦åˆ†ç±»

2. **pronunciation_attempts** (ç»ƒä¹ è®°å½•è¡¨)
   - è®°å½•æ¯æ¬¡ç»ƒä¹ çš„éŸ³é¢‘å’Œè¯„åˆ†
   - å­˜å‚¨å®Œæ•´çš„ API å“åº”
   - æ”¯æŒå†å²æŸ¥è¯¢å’Œåˆ†æ

3. **user_pronunciation_settings** (ç”¨æˆ·è®¾ç½®è¡¨)
   - æ¯æ—¥ç›®æ ‡æ•°é‡
   - éš¾åº¦åå¥½
   - åˆ†ç±»åå¥½
   - UI æ˜¾ç¤ºè®¾ç½®

4. **daily_practice_stats** (æ¯æ—¥ç»Ÿè®¡è¡¨)
   - æ¯æ—¥å®Œæˆæ•°é‡
   - å¹³å‡åˆ†æ•°
   - ç»ƒä¹ æ—¶é•¿
   - è¿›åº¦è¿½è¸ª

### RLS å®‰å…¨ç­–ç•¥

- âœ… è¯å¡ï¼šé¢„è®¾è¯åº“å…¬å¼€ï¼Œç”¨æˆ·è¯å¡ç§æœ‰
- âœ… ç»ƒä¹ è®°å½•ï¼šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- âœ… è®¾ç½®å’Œç»Ÿè®¡ï¼šå®Œå…¨ç§æœ‰

## ğŸ”§ æŠ€æœ¯æ ˆ

### å‰ç«¯
- **Framework**: Next.js 16 (React 19)
- **UI Library**: Radix UI + Tailwind CSS
- **State Management**: React Hooks
- **Audio Processing**: Web Audio API
- **Recording**: MediaRecorder API
- **TypeScript**: å®Œæ•´ç±»å‹å®šä¹‰

### åç«¯
- **Database**: Supabase PostgreSQL
- **Edge Functions**: Deno (Supabase)
- **File Storage**: Vercel Blob
- **API**: ç§‘å¤§è®¯é£è¯­éŸ³è¯„æµ‹ API

### éƒ¨ç½²
- **Frontend**: Vercel
- **Backend**: Supabase Cloud
- **Storage**: Vercel Blob Storage

## ğŸš€ éƒ¨ç½²æ­¥éª¤é€ŸæŸ¥

### 1. æ•°æ®åº“è®¾ç½®
```sql
-- åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ
-- scripts/pronunciation-schema.sql
```

### 2. Edge Function éƒ¨ç½²
```bash
supabase login
supabase link --project-ref YOUR_PROJECT_REF
supabase secrets set IFLYTEK_APPID=ga8b82c6
supabase secrets set IFLYTEK_API_KEY=d3c7a90d332a3ee97bbc710dcf45c746
supabase secrets set IFLYTEK_API_SECRET=7e4dbedce4d8353423b031572fb27d13
supabase functions deploy evaluate-pronunciation
```

### 3. ç¯å¢ƒå˜é‡é…ç½®
```bash
# .env.local
NEXT_PUBLIC_SUPABASE_URL=your_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_key
BLOB_READ_WRITE_TOKEN=your_blob_token
```

### 4. æœ¬åœ°å¼€å‘
```bash
pnpm install
pnpm dev
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### éŸ³é¢‘å¤„ç†
- å½•éŸ³æ ¼å¼ï¼šWebM/Opus
- è½¬æ¢æ ¼å¼ï¼šWAV (16kHz, 16-bit, Mono)
- å¹³å‡æ–‡ä»¶å¤§å°ï¼š50-100KB
- è½¬æ¢æ—¶é—´ï¼š< 1 ç§’

### API å“åº”æ—¶é—´
- éŸ³é¢‘ä¸Šä¼ ï¼š< 2 ç§’
- è¯„æµ‹å¤„ç†ï¼š3-5 ç§’
- æ€»ä½“æµç¨‹ï¼š< 8 ç§’

### æ•°æ®åº“æŸ¥è¯¢
- è¯å¡é€‰æ‹©ï¼š< 100ms
- ç»Ÿè®¡æŸ¥è¯¢ï¼š< 200ms
- å†å²è®°å½•ï¼š< 300ms

## ğŸ’° æˆæœ¬ä¼°ç®—

### å…è´¹é¢åº¦
- Supabase: 500MB æ•°æ®åº“ + 2GB å­˜å‚¨
- Vercel Blob: 1GB å­˜å‚¨
- ç§‘å¤§è®¯é£: 5 å¹¶å‘å…è´¹è¯•ç”¨

### å•†ç”¨æˆæœ¬ï¼ˆæ¯æœˆ 100 æ¬¡ç»ƒä¹ /å¤©ï¼‰
- ç§‘å¤§è®¯é£ API: ~Â¥6/æœˆ
- Vercel Blob: ~$1/æœˆ
- **æ€»è®¡**: çº¦ Â¥12/æœˆ

## ğŸ§ª è´¨é‡ä¿è¯

### TypeScript ç±»å‹æ£€æŸ¥
âœ… æ‰€æœ‰ç»„ä»¶å®Œå…¨ç±»å‹åŒ–
âœ… æ—  TypeScript é”™è¯¯ï¼ˆé™¤äº†å·²å­˜åœ¨çš„ dashboard ç»„ä»¶ï¼‰

### æµè§ˆå™¨å…¼å®¹æ€§
- âœ… Chrome 90+
- âœ… Firefox 88+
- âœ… Safari 14+
- âœ… Edge 90+

### ç§»åŠ¨ç«¯æ”¯æŒ
- âœ… iOS Safari 14+
- âœ… Android Chrome 90+

## ğŸ”® åç»­å¢å¼ºå»ºè®®

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰
1. æ·»åŠ æ›´å¤šé¢„è®¾è¯åº“ï¼ˆ200-500 è¯ï¼‰
2. å®ç°ç”¨æˆ·è‡ªå®šä¹‰è¯å¡ CRUD
3. æ·»åŠ ç»ƒä¹ æé†’åŠŸèƒ½
4. ä¼˜åŒ–ç§»åŠ¨ç«¯ UI

### ä¸­æœŸï¼ˆ1-2 æœˆï¼‰
1. ç¤¾äº¤åŠŸèƒ½ï¼šå¥½å‹ PKã€æ’è¡Œæ¦œ
2. å­¦ä¹ æŠ¥å‘Šï¼šå‘¨æŠ¥ã€æœˆæŠ¥
3. æˆå°±ç³»ç»Ÿï¼šå¾½ç« ã€å¥–åŠ±
4. ç¦»çº¿æ¨¡å¼ï¼šService Worker ç¼“å­˜

### é•¿æœŸï¼ˆ3-6 æœˆï¼‰
1. AI æ¨èç®—æ³•ä¼˜åŒ–
2. å¤šè¯­è¨€æ”¯æŒï¼ˆæ—¥è¯­ã€éŸ©è¯­ï¼‰
3. è¯­éŸ³åˆæˆç¤ºèŒƒæ’­æ”¾
4. è¯¾ç¨‹ä½“ç³»ï¼šåˆ†çº§å­¦ä¹ è·¯å¾„
5. æ•™å¸ˆç‰ˆï¼šç­çº§ç®¡ç†åŠŸèƒ½

## ğŸ“ ä½¿ç”¨è¯´æ˜

### å¯¹äºç”¨æˆ·

1. **å¼€å§‹ç»ƒä¹ **
   - ç‚¹å‡»å·¦ä¾§èœå•"å‘éŸ³ç»ƒä¹ "
   - ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©ä»Šæ—¥è¯å¡
   - ç‚¹å‡»éº¦å…‹é£æŒ‰é’®å¼€å§‹å½•éŸ³

2. **å½•éŸ³æŠ€å·§**
   - ç¡®ä¿ç¯å¢ƒå®‰é™
   - æ¸…æ™°æœ—è¯»å•è¯
   - ä¿æŒæ­£å¸¸è¯­é€Ÿ
   - å½•éŸ³æ—¶é•¿å»ºè®® 2-5 ç§’

3. **æŸ¥çœ‹ç»Ÿè®¡**
   - ç‚¹å‡»"å‘éŸ³ç»Ÿè®¡"æŸ¥çœ‹è¿›åº¦
   - æŸ¥çœ‹å†å²è®°å½•
   - åˆ†æå¼ºå¼±é¡¹

### å¯¹äºå¼€å‘è€…

1. **æ·»åŠ æ–°è¯å¡**
```sql
INSERT INTO word_cards (word, phonetic, translation, difficulty, category, language, is_preset)
VALUES ('example', '/ÉªÉ¡ËˆzÃ¦m.pÉ™l/', 'ä¾‹å­', 'medium', 'general', 'en', true);
```

2. **ä¿®æ”¹è¯„æµ‹å‚æ•°**
ç¼–è¾‘ `supabase/functions/evaluate-pronunciation/iflytek-client.ts` ä¸­çš„ `businessParams`

3. **è‡ªå®šä¹‰ UI**
ä¿®æ”¹ `components/pronunciation/` ç›®å½•ä¸‹çš„ç»„ä»¶

## ğŸ‰ ç»“è®º

æ¯æ—¥è¯å¡å‘éŸ³ç»ƒä¹ åŠŸèƒ½å·²ç»å®Œæ•´å®ç°å¹¶å¯ä»¥æŠ•å…¥ä½¿ç”¨ï¼

**ä¸»è¦æˆå°±ï¼š**
- âœ… å®Œæ•´çš„æ•°æ®åº“æ¶æ„
- âœ… å¯é çš„ API é›†æˆ
- âœ… æ™ºèƒ½çš„è¯å¡é€‰æ‹©ç®—æ³•
- âœ… å‹å¥½çš„ç”¨æˆ·ç•Œé¢
- âœ… è¯¦å°½çš„ç»Ÿè®¡åˆ†æ
- âœ… ç”Ÿäº§çº§ä»£ç è´¨é‡

**å‡†å¤‡å°±ç»ªï¼š**
- ğŸš€ å¯ç›´æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- ğŸ“± ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯å®Œå…¨æ”¯æŒ
- ğŸ”’ å®‰å…¨çš„æ•°æ®è®¿é—®æ§åˆ¶
- âš¡ ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°

å¼€å§‹äº«å—æ¯æ—¥å‘éŸ³ç»ƒä¹ å§ï¼ğŸ¤
